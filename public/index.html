<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Venom Parts</title>
  <link rel="icon" type="image/png" href="/branding/logo.png" />
  <link rel="stylesheet" href="/styles/main.css" />

</head>
<body>
  <div id="login-page" class="login-page" style="display:flex;">
    <section class="login-panel">
      <header class="login-header">
        <h1>Sign in</h1>
      </header>
      <form id="login-form" class="login-form">
        <label class="login-field">
          <span>Username</span>
          <input name="username" type="text" autocomplete="username" required />
        </label>
        <label class="login-field">
          <span>Password</span>
          <input name="password" type="password" autocomplete="current-password" required />
        </label>
        <button type="submit" class="login-button" id="login-submit">Sign in</button>
        <p id="login-message" class="login-error" style="display:none;"></p>
      </form>
    </section>
  </div>

  <div id="app-shell" style="display:none;">
  <header>
    <div class="brand">
      <img src="/branding/logo.png" alt="Venom Parts logo" />
      <div class="brand-text">
        <span class="brand-title">Venom Parts</span>
        <span class="brand-subtitle">FRC 8044 - Parts Ordering System</span>
      </div>
    </div>
    <div class="search">
      <input id="global-search" placeholder="Search parts, suppliers, users..." />
    </div>
    <div class="toolbar">
      <div class="toolbar-buttons">
        <button class="btn ghost" id="refresh-btn">Refresh</button>
        <button class="btn ghost" id="catalog-btn" style="display:none;">Catalog</button>
        <button class="btn ghost" id="admin-btn" style="display:none;">Admin</button>
        <button class="btn ghost" id="account-btn">Account</button>
        <button class="btn ghost" id="login-btn">Login</button>
        <button class="btn ghost" id="logout-btn" style="display:none;">Logout</button>
      </div>
      <div class="user-status">
        <span id="tracking-updated" class="small" style="color: var(--muted);"></span>
        <span id="user-chip" class="pill" style="background: var(--panel); border:1px solid var(--border);"></span>
      </div>
    </div>
  </header>

  <main>
    <div class="flex-between" style="align-items:flex-start; gap:12px; flex-wrap:wrap;">
      <div>
        <div class="page-title" id="primary-title">Orders</div>
        <div class="subtitle" id="primary-subtitle">Track parts from request to delivery.</div>
      </div>
      <div class="view-toggle" id="primary-view-toggle">
        <button id="orders-view-btn" class="active">Orders</button>
        <button id="stock-view-btn">Stock</button>
      </div>
    </div>

    <div id="orders-layout-row" class="flex-between" style="align-items:center; gap:12px; flex-wrap:wrap; margin-top:8px;">
      <div class="view-toggle" id="orders-layout-toggle">
        <button id="board-view-btn" class="active">Board</button>
        <button id="table-view-btn">Table</button>
        <button id="reimbursements-view-btn">Invoices</button>
      </div>
      <div class="flex-between" style="gap:8px; flex-wrap:wrap; margin-left:auto;">
        <button class="btn ghost" id="tags-btn" style="display:none;">Manage Tags</button>
        <button class="btn primary" id="new-order-btn">Request Part</button>
      </div>
    </div>

    <div id="selection-bar" class="selection-bar">
      <div style="display:flex; flex-direction:column; gap:4px; min-width:180px;">
        <div id="selection-count"></div>
        <div id="group-vendor-note" class="small">Vendor: auto from selection</div>
      </div>
      <div class="flex-between selection-actions" style="gap:8px;"></div>
    </div>

    <section id="board-section" style="flex:1; min-height:0; overflow:hidden; display:flex; flex-direction:column; padding-bottom: 12px;">
      <div class="board" id="board"></div>
    </section>

    <section id="table-section" style="display:none; flex:1; min-height:0; overflow:hidden; flex-direction:column;">
      <div class="filters">
        <div><label class="small">Start date</label><input id="start-date" class="input" type="date" /></div>
        <div><label class="small">End date</label><input id="end-date" class="input" type="date" /></div>
        <div><label class="small">Status</label><select id="status-filter" class="input"></select></div>
        <div><label class="small">Vendor</label><select id="vendor-filter" class="input"></select></div>
      </div>
      <div id="table-container" style="overflow:auto; flex:1; min-height:0; padding-bottom: 12px;"></div>
    </section>

    <section id="reimbursements-section" style="display:none; flex:1; min-height:0; overflow:hidden; flex-direction:column; gap:12px;">
      <div class="selection-bar" style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
        <div id="reimbursements-selection" class="small">No invoices selected</div>
        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-left:auto;">
          <div id="reimbursements-bulk" style="display:none; align-items:center; gap:8px; flex-wrap:wrap;">
            <select id="reimbursements-bulk-status" class="input" style="min-width:200px; padding:8px 12px; width:auto; height:38px; display:flex; align-items:center;"></select>
            <button class="btn ghost" id="reimbursements-bulk-apply" style="padding:8px 12px; height:38px; display:flex; align-items:center;">Set status</button>
          </div>
          <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <button class="btn ghost" id="reimbursements-undo" style="display:none;">Undo delete</button>
            <button class="btn ghost" id="reimbursements-delete" style="display:none; color: var(--danger); padding:8px 12px; height:38px; display:flex; align-items:center;">Delete</button>
          </div>
        </div>
      </div>
      <div class="filters" style="align-items:flex-end;">
        <div>
          <label class="small">Status</label>
          <select id="reimbursement-status-filter" class="input"></select>
        </div>
        <div>
          <label class="small">Person</label>
          <select id="reimbursement-scope-filter" class="input"></select>
        </div>
        <div>
          <label class="small">Vendor</label>
          <select id="reimbursement-vendor-filter" class="input"></select>
        </div>
      </div>
      <div id="reimbursements-table" class="card" style="background:var(--panel-2); padding:10px; overflow:auto; flex:1; min-height:240px;">Loading reimbursements...</div>
    </section>

    <section id="stock-section" style="display:none; flex:1; min-height:0; overflow:hidden; flex-direction:column; gap:12px;">
      <div class="flex-between" style="align-items:center; gap:8px; flex-wrap:wrap;">
        <div class="flex-between" style="gap:8px; flex-wrap:wrap; align-items:center;">
          <select id="stock-subteam-filter" class="input" style="min-width:180px;"></select>
        </div>
        <div class="flex-between" style="gap:8px; flex-wrap:wrap;">
          <button class="btn ghost" id="manage-subteams-btn" style="display:none;">Manage Locations</button>
          <button class="btn primary" id="add-stock-btn" style="display:none;">Add Stock</button>
        </div>
      </div>
      <div id="stock-grid" class="stock-grid" style="flex:1; min-height:0; overflow:auto; padding-bottom:12px;"></div>
    </section>
  </main>

  <div id="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:50; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:720px; width:100%; box-shadow:var(--card-shadow); padding:18px; max-height:90vh; overflow:auto;">
      <div class="flex-between" style="align-items:flex-start;">
        <div>
          <div class="page-title" style="font-size:22px;">Request Part</div>
          <div class="subtitle" style="margin-bottom:12px;">Provide a link or PN to fetch details from supported vendors; otherwise enter manually.</div>
        </div>
      </div>
      <form id="order-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap:12px;">
        <div style="grid-column: span 2;">
          <div id="order-source-toggle" style="display:inline-flex; gap:8px; flex-wrap:wrap;">
            <button type="button" class="btn ghost" data-source="manual" id="order-source-manual">Enter new part</button>
            <button type="button" class="btn ghost" data-source="catalog" id="order-source-catalog">Pick from catalog</button>
            <button type="button" class="btn ghost" data-source="import" id="order-source-import">Vendor import</button>
          </div>
        </div>
        <div id="order-import-fields" class="order-import-fields" style="grid-column: span 2; display:none;">
          <label class="small">Vendor import</label>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; align-items:center;">
            <select id="vendor-import-vendor" class="input">
              <option value="">Select vendor</option>
            </select>
            <div class="small" id="vendor-import-instructions">Upload a supported vendor CSV or paste part numbers and quantities.</div>
          </div>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:12px; margin-top:10px;">
            <div>
              <label class="small">Upload vendor CSV</label>
              <input type="file" id="vendor-import-file" class="input" accept=".csv,.xls,.xlsx,text/csv,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" />
            </div>
            <div>
              <label class="small">Paste part numbers (one per line)</label>
              <textarea id="vendor-import-text" class="input" rows="4" placeholder="Qty,Part Number or Part Number,Qty"></textarea>
            </div>
          </div>
          <div class="flex-between" style="gap:8px; flex-wrap:wrap; margin-top:8px;">
            <button type="button" class="btn ghost" id="vendor-import-clear" style="padding:6px 10px;">Clear</button>
            <div style="flex:1;"></div>
            <button type="button" class="btn primary" id="vendor-import-parse" style="padding:6px 12px;">Parse input</button>
          </div>
          <div id="vendor-import-message" class="small" style="margin-top:6px;"></div>
          <div id="vendor-import-preview" class="vendor-import-preview" style="margin-top:10px;"></div>
          <div class="flex-between" id="vendor-import-actions" style="display:none; align-items:center; gap:8px; margin-top:10px;">
            <div id="vendor-import-summary" class="small"></div>
            <button type="button" class="btn primary" id="vendor-import-submit">Add items</button>
          </div>
        </div>
        <div id="order-standard-fields" style="display:contents;">
          <div class="order-manual-fields" style="grid-column: span 2; border:1px solid var(--border); border-radius:10px; padding:10px; margin-bottom:10px;">
            <div style="font-weight:700; margin-bottom:6px;">Auto-fetch (not saved)</div>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:8px;">
              <div>
                <label class="small">Vendor source</label>
                <select id="manual-vendor-select" class="input">
                  <option value="">Other / manual entry</option>
                </select>
                <div class="small" id="manual-vendor-hint">Select a configured vendor to force API fetching, or leave as Other to auto-detect.</div>
              </div>
              <div>
                <label class="small">Product Number (fetch only)</label>
                <input id="order-fetch-part-number" class="input" placeholder="e.g., WCP-0921" />
              </div>
              <div>
                <label class="small">Supplier Link (fetch only)</label>
                <input id="order-fetch-link" class="input" placeholder="https://vendor.com/product/..." />
              </div>
            </div>
            <div style="margin-top:6px; display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
              <button type="button" class="btn primary" id="fetch-product" style="padding:6px 10px;">Fetch Details</button>
              <span class="small" id="fetch-supported">Supported vendors will auto-detect from link or part number.</span>
            </div>
          </div>
          <div class="order-catalog-fields" style="grid-column: span 2; display:none;">
            <label class="small">Saved catalog</label>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; align-items:center;">
              <input id="catalog-lookup" class="input" placeholder="Search saved parts..." />
              <div id="catalog-lookup-selected" class="small"></div>
            </div>
            <div id="catalog-lookup-results" class="tag-picker-options" style="display:none; margin-top:6px; max-height:180px; overflow:auto; background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:6px;"></div>
          </div>
          <div class="order-manual-fields" style="grid-column: span 2; border:1px solid var(--border); border-radius:10px; padding:10px; margin-top:8px;">
            <div style="font-weight:700; margin-bottom:6px;">Saved details</div>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:8px;">
              <div>
                <label class="small">Vendor</label>
                <input name="vendor" class="input" placeholder="Vendor" />
              </div>
              <div>
                <label class="small">Product Number</label>
                <input name="vendorPartNumber" class="input" placeholder="e.g., WCP-0921" />
                <input type="hidden" name="productCode" id="order-product-code" />
              </div>
              <div>
                <label class="small">Supplier Link</label>
                <input name="partLink" class="input" placeholder="https://vendor.com/product/..." />
              </div>
              <div>
                <label class="small">Part Name</label>
                <input name="partName" class="input" required />
              </div>
              <div>
                <label class="small">Unit Cost</label>
                <input name="unitCost" class="input" type="number" min="0" step="0.01" />
              </div>
              <div>
                <label class="small">Quantity</label>
                <input name="quantityRequested" class="input" type="number" min="1" value="1" required />
              </div>
              <div>
                <label class="small">Priority</label>
                <select name="priority" class="input">
                  <option>Low</option>
                  <option selected>Medium</option>
                  <option>High</option>
                  <option>Urgent</option>
                </select>
              </div>
            </div>
            <div style="margin-top:10px;">
              <label class="small">Tags</label>
              <select id="order-tags" name="tags" class="input" multiple size="4" style="min-height:90px; display:none;"></select>
              <div class="tag-picker" id="tag-picker">
                <div id="tag-picker-display" class="tag-picker-display">Select tags</div>
                <div id="tag-picker-panel" class="tag-picker-panel" style="display:none;">
                  <input id="tag-picker-search" class="input tag-picker-search" placeholder="Search tags..." />
                  <div id="tag-picker-options" class="tag-picker-options"></div>
                </div>
              </div>
              <div class="small" style="margin-top:8px;">Tags categorize requests. Open the Tags panel to view or manage them.</div>
            </div>
            <!-- Tracking managed at group level; no tracking fields for individual parts -->
            <div style="margin-top:10px;">
              <label class="small" id="order-notes-label">Notes</label>
              <textarea name="notes" class="input" rows="3" placeholder="Justification, sizing details, links, etc."></textarea>
            </div>
          </div>
          <div id="catalog-save-container" style="grid-column: span 2; display:none;">
            <div class="flex-between" style="align-items:center; gap:6px; flex-wrap:wrap;">
              <label class="small" style="display:flex; align-items:center; gap:6px;">
                <input type="checkbox" id="save-to-catalog-toggle" class="checkbox" />
                Save this part to the inventory catalog
              </label>
            </div>
            <div id="catalog-save-fields" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; margin-top:8px; display:none;">
              <div>
                <label class="small">Category path</label>
                <select id="catalog-save-category" class="input"></select>
              </div>
              <div>
                <label class="small">Subteam</label>
                <input id="catalog-save-subteam" class="input" placeholder="Electrical" />
              </div>
              <div>
                <label class="small">Type</label>
                <input id="catalog-save-type" class="input" placeholder="Connector" />
              </div>
            </div>
            <div id="catalog-save-message" class="small" style="margin-top:6px;"></div>
          </div>
          <div id="catalog-save-status" class="small" style="grid-column: span 2;"></div>
          <div class="flex-between" id="order-submit-bar" style="grid-column: span 2; margin-top:6px;">
            <div id="order-message" class="small"></div>
            <div class="flex-between" style="gap:8px;">
              <button type="button" class="btn ghost" id="cancel-order">Cancel</button>
              <button type="submit" class="btn primary">Submit order</button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div id="group-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:55; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:520px; width:100%; box-shadow:var(--card-shadow); padding:18px;">
      <div class="flex-between" style="align-items:flex-start;">
        <div>
          <div class="page-title" style="font-size:22px;">Edit Group</div>
          <div class="subtitle" style="margin-bottom:12px;">Update group title or tracking.</div>
        </div>
        <button class="btn ghost" id="close-group">Close</button>
      </div>
      <form id="group-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:10px;">
        <input type="hidden" name="id" />
        <div>
          <label class="small">Group title</label>
          <input name="title" class="input" placeholder="Vendor - mm/dd/yy" />
        </div>
        <div>
          <label class="small">Status tag</label>
          <select name="statusTag" id="group-status-tag" class="input">
            <option value="">No status tag</option>
          </select>
        </div>
        <div style="grid-column: span 2;">
          <label class="small">Tracking numbers</label>
          <div id="group-modal-tracking-list" class="tracking-list"></div>
          <button type="button" class="btn ghost" id="add-group-modal-tracking" style="padding:6px 10px; margin-top:4px;">Add tracking</button>
        </div>
        <div style="grid-column: span 2;">
          <label class="small">Notes</label>
          <textarea name="notes" class="input" rows="3" placeholder="Optional notes for this order group"></textarea>
        </div>
        <div class="flex-between" style="grid-column: span 2; margin-top:6px;">
          <div id="group-message" class="small"></div>
          <div class="flex-between" style="gap:8px;">
            <button type="button" class="btn ghost" id="cancel-group">Cancel</button>
            <button type="submit" class="btn primary">Save group</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div id="catalog-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:58; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:1100px; width:100%; box-shadow:var(--card-shadow); padding:18px; max-height:90vh; overflow:auto;">
      <div class="flex-between" style="align-items:flex-start; gap:8px; flex-wrap:wrap;">
        <div>
          <div class="page-title" style="font-size:22px;">Inventory Catalog</div>
          <div class="subtitle" style="margin-bottom:12px;">Browse saved parts by category.</div>
        </div>
        <button class="btn ghost" id="close-catalog">Close</button>
      </div>
      <div class="grid" style="grid-template-columns: minmax(280px, 1fr) 2fr; gap:12px; align-items:start;">
        <div style="display:flex; flex-direction:column; gap:10px; padding-bottom:12px;">
          <div class="flex-between" style="align-items:center; gap:8px;">
            <div class="page-title" style="font-size:15px;">Categories</div>
            <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:center;">
              <button class="btn ghost" id="catalog-back" style="padding:6px 10px; display:none;">Back</button>
              <button class="btn ghost" id="refresh-catalog-categories" style="padding:6px 10px;">Refresh</button>
              <button class="btn primary" id="catalog-new-category" style="padding:6px 10px;">New Category</button>
            </div>
          </div>
          <div class="small" id="catalog-path-display"></div>
          <div id="catalog-category-list" class="empty" style="min-height:140px;">Loading categories...</div>
        </div>
        <div style="display:flex; flex-direction:column; gap:10px;">
          <div class="flex-between" style="align-items:center; gap:8px; flex-wrap:wrap;">
            <div>
              <div class="page-title" style="font-size:15px;">Catalog items</div>
              <div class="small" id="catalog-item-hint">Select a category to focus results.</div>
            </div>
            <div class="flex-between" style="gap:6px; align-items:center; margin-left:auto; flex-wrap:nowrap;">
              <input id="catalog-item-search" class="input" placeholder="Search saved parts..." style="min-width:220px; flex:1;" />
              <button class="btn ghost" id="refresh-catalog-items" style="padding:6px 10px; white-space:nowrap;">Refresh</button>
              <button class="btn primary" id="new-catalog-item" style="padding:6px 10px; white-space:nowrap;">New item</button>
            </div>
          </div>
          <div id="catalog-item-list" class="empty">No catalog items yet.</div>
        </div>
      </div>
    </div>
  </div>

  <div id="catalog-item-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:66; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:720px; width:100%; box-shadow:var(--card-shadow); padding:18px; max-height:90vh; overflow:auto;">
      <div class="flex-between" style="align-items:flex-start; gap:8px; flex-wrap:wrap;">
        <div>
          <div class="page-title" style="font-size:20px;">Catalog item</div>
          <div class="subtitle" id="catalog-item-modal-hint" style="margin-bottom:10px;">Create or edit a saved part.</div>
        </div>
      </div>
      <form id="catalog-item-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; margin-top:4px;">
        <input type="hidden" name="id" />
        <div style="grid-column: span 2; border:1px solid var(--border); border-radius:10px; padding:10px; margin-bottom:10px;">
          <div style="font-weight:700; margin-bottom:6px;">Auto-fetch (not saved)</div>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px;">
            <div>
              <label class="small">Vendor source</label>
              <select id="catalog-vendor-select" class="input">
                <option value="">Other / manual entry</option>
              </select>
              <div class="small" id="catalog-vendor-hint">Select a configured vendor for API autofill, or leave as Other.</div>
            </div>
            <div>
              <label class="small">Product Number (fetch only)</label>
              <input id="fetch-catalog-part-number" class="input" placeholder="SKU for lookup" />
            </div>
            <div>
              <label class="small">Supplier Link (fetch only)</label>
              <input id="fetch-catalog-link" class="input" placeholder="https://vendor.com/part" />
            </div>
          </div>
          <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap; margin-top:10px;">
            <button type="button" class="btn primary" id="fetch-catalog-product" style="padding:6px 10px;">Fetch Details</button>
            <span class="small" id="fetch-supported-catalog">Supported vendors will auto-detect from link or part number.</span>
          </div>
        </div>
        <div style="grid-column: span 2; border:1px solid var(--border); border-radius:10px; padding:10px;">
          <div style="font-weight:700; margin-bottom:6px;">Saved details</div>
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px;">
            <div>
              <label class="small">Vendor</label>
              <input name="vendor" class="input" placeholder="WCP, DigiKey..." />
            </div>
            <div>
              <label class="small">Product Number</label>
              <input name="vendorPartNumber" class="input" placeholder="SKU" />
            </div>
            <div>
              <label class="small">Supplier Link</label>
              <input name="supplierLink" class="input" placeholder="https://vendor.com/part" />
            </div>
            <div>
              <label class="small">Part Name</label>
              <input name="name" class="input" required />
            </div>
            <div>
              <label class="small">Category Path</label>
              <input name="categoryPath" class="input" placeholder="Electrical/Connectors/Molex" />
            </div>
            <div>
              <label class="small">Unit Cost</label>
              <input name="unitCost" class="input" type="number" step="0.01" />
            </div>
            <div>
              <label class="small">Default Quantity</label>
              <input name="defaultQuantity" class="input" type="number" min="1" placeholder="1" />
            </div>
            <div>
              <label class="small">Subteam</label>
              <input name="subteam" class="input" placeholder="Electrical" />
            </div>
            <div>
              <label class="small">Type</label>
              <input name="type" class="input" placeholder="Connector" />
            </div>
            <div style="grid-column: span 2;">
              <label class="small">Aliases (comma separated)</label>
              <input name="aliases" class="input" placeholder="crimp, molex, male" />
            </div>
          </div>
        </div>
        <div class="flex-between" style="grid-column: span 2; gap:8px; flex-wrap:wrap; margin-top:6px;">
          <div id="catalog-item-message" class="small"></div>
          <div class="flex-between" style="gap:6px;">
            <button type="button" class="btn ghost" id="cancel-catalog-item">Cancel</button>
            <button type="button" class="btn ghost" id="delete-catalog-item" style="color:var(--danger);">Delete</button>
            <button type="submit" class="btn primary">Save item</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div id="user-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:70; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:560px; width:100%; box-shadow:var(--card-shadow); padding:18px; max-height:90vh; overflow:auto;">
      <div class="flex-between" style="align-items:flex-start; gap:8px; flex-wrap:wrap;">
        <div>
          <div class="page-title" style="font-size:20px;">User management</div>
          <div class="subtitle" style="margin-bottom:10px;">Create or edit a user account.</div>
        </div>
        <button class="btn ghost" id="close-user-modal">Close</button>
      </div>
      <form id="user-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; margin-top:10px;">
        <input type="hidden" name="id" />
        <div>
          <label class="small">Username</label>
          <input name="username" class="input" required />
        </div>
        <div>
          <label class="small">Name</label>
          <input name="name" class="input" required />
        </div>
        <div>
          <label class="small">Role</label>
          <select name="role" class="input">
            <option>admin</option>
            <option>mentor</option>
            <option>student</option>
          </select>
        </div>
        <div>
          <label class="small">Password (set/reset)</label>
          <input name="password" class="input" type="password" placeholder="Leave blank to keep existing" />
        </div>
        <div>
          <label class="small">Active</label>
          <select name="active" class="input">
            <option value="true">Active</option>
            <option value="false">Inactive</option>
          </select>
        </div>
        <div class="flex-between" style="grid-column: span 2; margin-top:6px;">
          <div id="user-message" class="small"></div>
          <div class="flex-between" style="gap:8px;">
            <button type="button" class="btn ghost" id="cancel-user">Cancel</button>
            <button type="submit" class="btn primary" id="save-user-btn">Create user</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div id="vendor-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:68; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:900px; width:100%; box-shadow:var(--card-shadow); padding:18px; max-height:90vh; overflow:auto;">
      <div class="flex-between" style="align-items:flex-start; gap:8px; flex-wrap:wrap;">
        <div>
          <div class="page-title" style="font-size:20px;">Vendor extraction</div>
          <div class="subtitle" style="margin-bottom:10px;">Create or edit vendor configurations.</div>
        </div>
        <button class="btn ghost" id="close-vendor-modal">Close</button>
      </div>
      <form id="vendor-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:12px; margin-top:10px;">
        <input type="hidden" name="id" />
        <input type="hidden" name="integrationKey" />
        <div id="vendor-builtin-panel" style="display:none; grid-column: span 2;">
          <div id="builtin-vendor-description" class="small" style="margin-bottom:6px;"></div>
          <div id="builtin-vendor-capabilities" class="small" style="display:flex; flex-wrap:wrap; gap:6px; margin-bottom:10px;"></div>
          <div id="builtin-fields" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:10px;"></div>
        </div>
        <div id="vendor-custom-panel" style="display:contents;">
          <div>
            <label class="small">Vendor name</label>
            <input name="vendor" class="input" placeholder="e.g., WCP" />
          </div>
          <div>
            <label class="small">Base URL</label>
            <input name="baseUrl" class="input" placeholder="https://wcproducts.com" />
          </div>
          <div>
            <label class="small">Product URL template</label>
            <input name="productUrlTemplate" class="input" placeholder="https://wcproducts.com/products/{partNumber}" />
            <div class="small">Use {partNumber} where the SKU goes, e.g. https://vendor.com/products/{partNumber}</div>
          </div>
          <div>
            <label class="small">Part # example</label>
            <input name="partNumberExample" class="input" placeholder="WCP-0921" />
          </div>
          <div>
            <label class="small">Part # regex</label>
            <input name="partNumberPattern" class="input" placeholder="^WCP-\\d+$" />
            <div class="small">Auto-filled from example; edit to tighten/loosen validation.</div>
          </div>
          <div>
            <label class="small">Name selector</label>
            <input name="nameSelector" class="input" placeholder=".product-title" />
          </div>
          <div>
            <label class="small">Price selector</label>
            <input name="priceSelector" class="input" placeholder=".price" />
          </div>
          <div style="grid-column: span 2;">
            <label class="small">Paste copied selector or JS path</label>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:8px;">
              <textarea id="selector-snippet" class="input" rows="2" placeholder="Right-click → Copy selector or Copy JS path"></textarea>
              <div class="grid" style="grid-template-columns: 1fr 1fr; gap:6px;">
                <select id="selector-target" class="input">
                  <option value="nameSelector">Apply to Name</option>
                  <option value="priceSelector">Apply to Price</option>
                </select>
                <button type="button" class="btn ghost" id="apply-selector">Apply</button>
              </div>
            </div>
            <div class="small">Tip: Use “Copy selector” or “Copy JS path” from DevTools.</div>
          </div>
          <div style="grid-column: span 2;">
            <label class="small">Notes / headers JSON (optional)</label>
            <textarea name="notes" class="input" rows="2" placeholder="Headers: {\"User-Agent\":\"...\"}"></textarea>
          </div>
          <div style="grid-column: span 2;">
            <div class="small" style="margin-bottom:6px;">Test extraction (paste a product URL)</div>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:8px;">
              <input id="test-url" class="input" placeholder="https://vendor.com/product/123" />
              <button type="button" class="btn primary" id="test-extract">Test</button>
            </div>
            <div id="extract-results" class="small" style="margin-top:8px;"></div>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; margin-top:8px;">
              <div>
                <label class="small">Pick name</label>
                <select id="pick-name" class="input"></select>
                <div id="preview-name" class="small"></div>
              </div>
              <div>
                <label class="small">Pick price</label>
                <select id="pick-price" class="input"></select>
                <div id="preview-price" class="small"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex-between" style="grid-column: span 2; margin-top:6px;">
          <div id="vendor-message" class="small"></div>
          <div class="flex-between" style="gap:8px;">
            <button type="button" class="btn ghost" id="cancel-vendor">Cancel</button>
            <button type="submit" class="btn primary">Save vendor</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div id="account-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:65; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:500px; width:100%; box-shadow:var(--card-shadow); padding:18px;">
      <div class="page-title" style="font-size:22px;">My Account</div>
      <div class="subtitle" style="margin-bottom:12px;">Update your password.</div>
      <form id="password-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:8px; margin-top:8px;">
        <div>
          <label class="small">Old password</label>
          <input name="oldPassword" class="input" type="password" required />
        </div>
        <div>
          <label class="small">New password</label>
          <input name="newPassword" class="input" type="password" required />
        </div>
        <div class="flex-between" style="grid-column: span 2; margin-top:6px;">
          <div id="password-message" class="small"></div>
          <button type="submit" class="btn primary">Update password</button>
        </div>
      </form>
    </div>
  </div>

  <div id="catalog-category-new-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:64; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:420px; width:100%; box-shadow:var(--card-shadow); padding:18px;">
      <div class="page-title" style="font-size:20px;">New category</div>
      <div class="subtitle" id="catalog-category-new-path" style="margin-bottom:10px;"></div>
      <form id="catalog-category-new-form" class="grid" style="grid-template-columns:1fr; gap:10px; padding-bottom:6px;">
        <div>
          <label class="small">Name</label>
          <input name="name" class="input" placeholder="Category name" required />
        </div>
        <div class="flex-between" style="gap:8px; margin-top:6px;">
          <div id="catalog-category-new-message" class="small"></div>
          <div class="flex-between" style="gap:8px;">
            <button type="button" class="btn ghost" id="catalog-category-new-cancel">Cancel</button>
            <button type="submit" class="btn primary">Create</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div id="catalog-category-edit-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:64; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:460px; width:100%; box-shadow:var(--card-shadow); padding:18px;">
      <div class="page-title" style="font-size:20px;">Edit category</div>
      <div class="subtitle" id="catalog-category-edit-path" style="margin-bottom:10px;"></div>
      <form id="catalog-category-edit-form" class="grid" style="grid-template-columns:1fr; gap:10px; padding-bottom:6px;">
        <input type="hidden" name="id" />
        <div>
          <label class="small">Name</label>
          <input name="name" class="input" required />
        </div>
        <div>
          <label class="small">Move to</label>
          <select name="parentId" class="input"></select>
        </div>
        <div class="flex-between" style="gap:8px; margin-top:6px;">
          <div id="catalog-category-edit-message" class="small"></div>
          <div class="flex-between" style="gap:8px;">
            <button type="button" class="btn ghost" id="catalog-category-edit-cancel">Cancel</button>
            <button type="submit" class="btn primary">Save</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div id="tags-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:62; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:900px; width:100%; box-shadow:var(--card-shadow); padding:18px; max-height:90vh; overflow:auto;">
      <div class="flex-between" style="align-items:flex-start;">
        <div>
          <div class="page-title" style="font-size:22px;">Tags &amp; priorities</div>
          <div class="subtitle" style="margin-bottom:12px;">View tags and priorities. Editing requires the Manage Tags permission.</div>
        </div>
        <button class="btn ghost" id="close-tags">Close</button>
      </div>
        <div class="flex-between" style="margin-top:10px; gap:8px;">
          <div class="flex-between" style="gap:6px; flex-wrap:wrap;">
            <button class="btn ghost" id="tags-tab-tags">Organization tags</button>
            <button class="btn ghost" id="tags-tab-priorities">Priority tags</button>
            <button class="btn ghost" id="tags-tab-status">Status tags</button>
            <button class="btn ghost" id="tags-tab-reimbursements">Reimbursement statuses</button>
          </div>
        </div>
        <div id="tags-section" class="card" style="background:var(--panel-2); margin-top:10px;">
          <div class="flex-between" style="align-items:flex-start;">
            <div>
            <div class="page-title" style="font-size:18px;">Organization tags</div>
            <div class="subtitle" style="margin-bottom:12px;">Manage tags used to categorize requests.</div>
          </div>
          <div class="flex-between" style="gap:8px;">
            <button class="btn ghost" id="refresh-tags">Refresh</button>
          </div>
        </div>
        <form id="create-tag-form" class="admin-inline-form" style="margin-top:10px;">
          <input id="tag-color-input" class="inline-color" type="color" value="#fdd023" />
          <input id="tag-label-input" class="input" placeholder="New tag name" required style="flex:1; min-width:180px;" />
          <button type="submit" class="btn primary">New tag</button>
        </form>
        <div id="tags-message" class="small" style="margin-top:6px;"></div>
        <div id="tags-list" class="tag-manager-list" style="margin-top:10px;"></div>
      </div>
      <div id="priorities-section" class="card" style="background:var(--panel-2); margin-top:10px; display:none;">
        <div class="flex-between" style="align-items:flex-start;">
          <div>
            <div class="page-title" style="font-size:18px;">Priority tags</div>
            <div class="subtitle" style="margin-bottom:12px;">Customize priority labels and colors.</div>
          </div>
          <div class="flex-between" style="gap:8px;">
            <button class="btn ghost" id="refresh-priorities">Refresh</button>
          </div>
        </div>
        <form id="create-priority-form" class="admin-inline-form" style="margin-top:10px;">
          <input id="priority-color-input" class="inline-color" type="color" value="#fdd023" />
          <input id="priority-label-input" class="input" placeholder="Priority name (e.g., Medium)" required style="flex:1; min-width:180px;" />
          <input id="priority-sort-input" class="input" type="number" placeholder="Sort" style="width:80px;" />
          <button type="submit" class="btn primary">New priority</button>
        </form>
        <div id="priorities-message" class="small" style="margin-top:6px;"></div>
        <div id="priorities-list" class="tag-manager-list" style="margin-top:10px;"></div>
      </div>
      <div id="statuses-section" class="card" style="background:var(--panel-2); margin-top:10px; display:none;">
        <div class="flex-between" style="align-items:flex-start;">
          <div>
            <div class="page-title" style="font-size:18px;">Status tags</div>
            <div class="subtitle" style="margin-bottom:12px;">Custom statuses for grouped orders.</div>
          </div>
          <div class="flex-between" style="gap:8px;">
            <button class="btn ghost" id="refresh-statuses">Refresh</button>
          </div>
        </div>
        <form id="create-status-form" class="admin-inline-form" style="margin-top:10px;">
          <input id="status-color-input" class="inline-color" type="color" value="#5aa0ff" />
          <input id="status-label-input" class="input" placeholder="Status name (e.g., PO Placed)" required style="flex:1; min-width:180px;" />
          <input id="status-sort-input" class="input" type="number" placeholder="Sort" style="width:80px;" />
          <button type="submit" class="btn primary">New status</button>
        </form>
        <div id="statuses-message" class="small" style="margin-top:6px;"></div>
        <div id="statuses-list" class="tag-manager-list" style="margin-top:10px;"></div>
      </div>
      <div id="reimbursements-tags-section" class="card" style="background:var(--panel-2); margin-top:10px; display:none;">
        <div class="flex-between" style="align-items:flex-start;">
          <div>
            <div class="page-title" style="font-size:18px;">Reimbursement statuses</div>
            <div class="subtitle" style="margin-bottom:12px;">Customize invoice/reimbursement status options.</div>
          </div>
          <div class="flex-between" style="gap:8px;">
            <button class="btn ghost" id="refresh-reimbursement-tags">Refresh</button>
          </div>
        </div>
        <form id="create-reimbursement-tag-form" class="admin-inline-form" style="margin-top:10px;">
          <input id="reimbursement-tag-color-input" class="inline-color" type="color" value="#5aa0ff" />
          <input id="reimbursement-tag-label-input" class="input" placeholder="Status name (e.g., Reimbursed)" required style="flex:1; min-width:180px;" />
          <input id="reimbursement-tag-sort-input" class="input" type="number" placeholder="Sort" style="width:80px;" />
          <button type="submit" class="btn primary">New status</button>
        </form>
        <div id="reimbursement-tags-message" class="small" style="margin-top:6px;"></div>
        <div id="reimbursement-tags-list" class="tag-manager-list" style="margin-top:10px;"></div>
      </div>
    </div>
  </div>

  <div id="catalog-request-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:64; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:520px; width:100%; box-shadow:var(--card-shadow); padding:18px;">
      <div class="flex-between" style="align-items:flex-start;">
        <div>
          <div class="page-title" style="font-size:20px;">Request catalog item</div>
          <div class="subtitle" id="catalog-request-subtitle" style="margin-bottom:12px;">Choose quantity and confirm.</div>
        </div>
      </div>
      <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:10px;">
        <div>
          <label class="small">Quantity to request</label>
          <input id="catalog-request-qty" class="input" type="number" min="1" value="1" />
        </div>
        <div>
          <label class="small">Priority</label>
          <select id="catalog-request-priority" class="input">
            <option>Low</option>
            <option selected>Medium</option>
            <option>High</option>
            <option>Urgent</option>
          </select>
        </div>
        <div style="grid-column: span 2;">
          <label class="small">Tags</label>
          <select id="catalog-request-tags" class="input" multiple size="4" style="min-height:90px; display:none;"></select>
          <div class="tag-picker" id="catalog-request-tag-picker">
            <div id="catalog-request-tag-picker-display" class="tag-picker-display">Select tags</div>
            <div id="catalog-request-tag-picker-panel" class="tag-picker-panel" style="display:none;">
              <input id="catalog-request-tag-picker-search" class="input tag-picker-search" placeholder="Search tags..." />
              <div id="catalog-request-tag-picker-options" class="tag-picker-options"></div>
            </div>
          </div>
        </div>
        <div style="grid-column: span 2;">
          <label class="small">Notes</label>
          <textarea id="catalog-request-notes" class="input" rows="3" placeholder="Add justification, sizing, links, etc."></textarea>
        </div>
      </div>
      <div class="flex-between" style="margin-top:10px;">
        <div id="catalog-request-message" class="small"></div>
        <div class="flex-between" style="gap:8px;">
          <button class="btn ghost" id="cancel-catalog-request">Cancel</button>
          <button class="btn primary" id="confirm-catalog-request">Add to requests</button>
        </div>
      </div>
    </div>
  </div>

  <div id="stock-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:63; align-items:center; justify-content:center; padding:16px;">
    <div class="tag-modal-card">
      <div class="flex-between" style="align-items:flex-start;">
        <div>
          <div class="page-title" id="stock-modal-title" style="font-size:20px;">Add Stock</div>
        <div class="subtitle" id="stock-modal-subtitle" style="margin-bottom:10px;">Pick a catalog part to track and set the starting quantity and location.</div>
        </div>
        <button class="btn ghost" id="close-stock-modal">Close</button>
      </div>
      <form id="stock-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:8px; margin-top:8px;">
        <input type="hidden" name="id" />
        <div style="grid-column: span 2;">
          <label class="small">Saved catalog</label>
          <input id="stock-catalog-search" class="input" placeholder="Search saved parts..." />
          <div id="stock-catalog-selected" class="small" style="margin-top:6px;"></div>
          <div id="stock-catalog-results" class="tag-picker-options" style="display:none; margin-top:6px; max-height:200px; overflow:auto; background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:6px;"></div>
        </div>
        <div>
          <label class="small">Subteam</label>
          <select id="stock-subteam-select" class="input"></select>
        </div>
        <div>
          <label class="small">Quantity on hand</label>
          <input id="stock-quantity" class="input" type="number" min="0" value="0" />
        </div>
        <div>
          <label class="small">Low stock alert at</label>
          <input id="stock-low" class="input" type="number" min="0" placeholder="e.g., 5" />
        </div>
        <div>
          <label class="small">Location</label>
          <input id="stock-location" class="input" placeholder="Bay, drawer, bin" />
        </div>
        <div>
          <label class="small">Stock category (per location)</label>
          <input id="stock-category" class="input" placeholder="e.g., Fasteners, Raw Stock" />
        </div>
        <div style="grid-column: span 2;">
          <label class="small">Notes</label>
          <textarea id="stock-notes" class="input" rows="2" placeholder="Label, kit info, etc."></textarea>
        </div>
        <div class="flex-between" style="grid-column: span 2; margin-top:6px;">
          <div id="stock-modal-message" class="small"></div>
          <div class="flex-between" style="gap:8px;">
            <button type="button" class="btn ghost" id="delete-stock-btn" style="display:none; color: var(--danger);">Untrack</button>
            <button type="button" class="btn ghost" id="cancel-stock">Cancel</button>
            <button type="submit" class="btn primary">Save</button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <div id="stock-delete-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:64; align-items:center; justify-content:center; padding:16px;">
    <div class="tag-modal-card" style="max-width:420px; width:100%;">
      <div class="page-title" style="font-size:20px;">Untrack stock item</div>
      <div class="subtitle" style="margin-bottom:12px;">This will remove the item from live stock tracking.</div>
      <div id="stock-delete-message" class="small" style="margin-bottom:12px;">Are you sure you want to untrack this item?</div>
      <div class="flex-between" style="gap:8px; flex-wrap:wrap;">
        <button class="btn ghost" id="cancel-delete-stock">Cancel</button>
        <button class="btn primary" id="confirm-delete-stock" style="background: var(--danger); border-color: var(--danger); color: #fff;">Untrack</button>
      </div>
    </div>
  </div>

  <div id="confirm-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:70; align-items:center; justify-content:center; padding:16px;">
    <div class="tag-modal-card" style="max-width:420px; width:100%;">
      <div class="page-title" style="font-size:20px;">Confirm action</div>
      <div id="confirm-message" class="subtitle" style="margin-bottom:12px;">Are you sure?</div>
      <div id="confirm-extra" style="margin-bottom:12px; display:none;"></div>
      <div id="confirm-status" class="small" style="margin-bottom:12px;"></div>
      <div class="flex-between" style="gap:8px; flex-wrap:wrap;">
        <button class="btn ghost" id="confirm-cancel">Cancel</button>
        <button class="btn primary" id="confirm-ok" style="background: var(--danger); border-color: var(--danger); color: #fff;">Confirm</button>
      </div>
    </div>
  </div>

  <div id="vendor-export-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:72; align-items:center; justify-content:center; padding:16px;">
    <div class="tag-modal-card" style="max-width:520px; width:100%;">
      <div class="flex-between" style="align-items:flex-start; gap:8px; flex-wrap:wrap;">
        <div>
          <div class="page-title" id="vendor-export-title" style="font-size:20px;">Vendor export</div>
          <div class="subtitle" id="vendor-export-description" style="margin-top:2px;">Provide this data to the vendor’s quick order form.</div>
        </div>
        <button class="btn ghost" id="close-vendor-export">Close</button>
      </div>
      <div style="margin-top:12px;">
        <label class="small">Copy/paste list</label>
        <textarea id="vendor-export-text" class="input" rows="8" readonly style="margin-top:6px;"></textarea>
      </div>
      <div class="flex-between" style="gap:8px; flex-wrap:wrap; margin-top:12px;">
        <button class="btn ghost" id="vendor-export-copy">Copy list</button>
        <button class="btn primary" id="vendor-export-download">Download CSV</button>
      </div>
      <div id="vendor-export-message" class="small" style="margin-top:8px;"></div>
    </div>
  </div>

  <div id="action-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.35); z-index:80; align-items:center; justify-content:center;">
    <div style="background:rgba(0,0,0,0.65); color:var(--text); padding:14px 18px; border-radius:12px; display:flex; align-items:center; gap:10px; box-shadow:0 6px 30px rgba(0,0,0,0.45);">
      <div class="spinner" style="width:18px; height:18px; border:3px solid var(--border); border-top-color: var(--primary); border-radius:50%; animation:spin 0.8s linear infinite;"></div>
      <div id="action-overlay-text" class="small">Working…</div>
    </div>
  </div>

  <div id="group-detail-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:48; align-items:center; justify-content:center; padding:16px;">
    <div class="tag-modal-card" style="max-width:900px; width:100%; display:flex; flex-direction:column; gap:12px;">
      <div class="group-detail-header">
        <div>
          <div class="page-title" id="group-detail-title" style="font-size:20px;"></div>
          <div class="meta" id="group-detail-meta" style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;"></div>
        </div>
        <div class="group-detail-actions" id="group-detail-actions"></div>
      </div>
      <div id="group-detail-tracking" class="meta" style="display:flex; gap:6px; flex-wrap:wrap;"></div>
      <div id="group-detail-parts" class="group-detail-parts"></div>
      <div style="display:flex; justify-content:flex-end; gap:8px;">
        <button class="btn ghost" id="close-group-detail">Close</button>
      </div>
    </div>
  </div>

  <div id="invoice-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:62; align-items:center; justify-content:center; padding:16px;">
    <div class="tag-modal-card" style="max-width:900px; width:100%; display:flex; flex-direction:column; gap:12px;">
      <div class="flex-between" style="align-items:flex-start; gap:8px;">
        <div>
          <div class="page-title" style="font-size:20px;">Invoices & Reimbursements</div>
          <div class="subtitle" id="invoice-target-summary" style="margin-bottom:6px;"></div>
        </div>
        <div class="flex-between" style="gap:8px; flex-wrap:wrap;">
          <button class="btn ghost" id="new-invoice-btn" style="display:none;">New Invoice</button>
          <button class="btn ghost" id="close-invoice-modal">Close</button>
        </div>
      </div>
      <div id="invoice-existing-list" class="tag-manager-list" style="max-height:520px; overflow:auto;"></div>
    </div>
  </div>

  <div id="invoice-editor-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:70; align-items:center; justify-content:center; padding:16px;">
    <div class="tag-modal-card" style="max-width:820px; width:100%; display:flex; flex-direction:column; gap:12px;">
      <div class="flex-between" style="align-items:flex-start;">
        <div>
          <div class="page-title" id="invoice-editor-title" style="font-size:20px;">New Invoice</div>
          <div class="subtitle" id="invoice-editor-subtitle"></div>
        </div>
      </div>
      <form id="invoice-editor-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:12px; border:1px solid var(--border); border-radius:12px; padding:12px;">
        <input type="hidden" name="mode" value="create" />
        <input type="hidden" name="invoiceId" />
        <input type="hidden" name="orderId" />
        <input type="hidden" name="groupId" />
        <div id="invoice-file-field" style="grid-column: span 2; display:flex; gap:8px; align-items:flex-end; flex-wrap:wrap;">
          <div style="flex:1; min-width:240px;">
            <label class="small">Upload receipts (PDF or images)</label>
            <input id="invoice-files" name="files" class="input" type="file" accept=".pdf,image/*" multiple />
          </div>
        </div>
        <div id="invoice-preview" style="grid-column: span 2; border:1px solid var(--border); border-radius:12px; min-height:200px; padding:8px;">
          <div class="small">Select a file to preview.</div>
        </div>
        <div style="grid-column: span 2;">
          <label class="small">Invoice total</label>
          <input name="amount" class="input" type="text" inputmode="decimal" placeholder="Enter total from invoice" />
        </div>
        <div id="invoice-status-field" style="grid-column: span 2;">
          <label class="small">Reimbursement status</label>
          <select name="reimbursementStatus" class="input"></select>
        </div>
        <div style="grid-column: span 2;">
          <label class="small">Notes</label>
          <textarea name="notes" class="input" rows="3" placeholder="Optional context for treasurer"></textarea>
        </div>
        <div class="flex-between" style="grid-column: span 2; align-items:center; flex-wrap:wrap; gap:8px;">
          <div id="invoice-message" class="small"></div>
          <div class="flex-between" style="gap:8px; flex-wrap:wrap;">
            <button type="button" class="btn ghost" id="close-invoice-editor">Close</button>
            <button type="submit" class="btn primary" id="save-invoice-btn">Submit invoice</button>
          </div>
        </div>
      </form>
    </div>
  </div>

    <div id="stock-subteams-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:63; align-items:center; justify-content:center; padding:16px;">
      <div class="tag-modal-card">
        <div class="flex-between" style="align-items:flex-start;">
          <div>
          <div class="page-title" style="font-size:20px;">Stock locations</div>
          <div class="subtitle" style="margin-bottom:10px;">Control the location options used for stock filtering.</div>
          </div>
          <button class="btn ghost" id="close-subteams-modal">Close</button>
        </div>
      <form id="stock-subteam-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; margin-top:6px;">
        <input type="hidden" name="id" />
        <div>
          <label class="small">Name</label>
          <input name="name" class="input" placeholder="e.g., Electrical, Drivetrain" required />
        </div>
        <div>
          <label class="small">Description</label>
          <input name="description" class="input" placeholder="Optional context" />
        </div>
        <div class="flex-between" style="grid-column: span 2; margin-top:6px;">
          <div id="stock-subteam-message" class="small"></div>
          <div class="flex-between" style="gap:8px;">
            <button type="button" class="btn ghost" id="clear-subteam-form">New</button>
            <button type="submit" class="btn primary">Save</button>
          </div>
        </div>
      </form>
      <div id="stock-subteam-list" class="tag-manager-list" style="margin-top:10px;"></div>
    </div>
  </div>

      <div id="admin-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.65); z-index:60; align-items:center; justify-content:center; padding:16px;">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; max-width:900px; width:100%; box-shadow:var(--card-shadow); padding:18px; max-height:90vh; overflow:auto;">
      <div class="flex-between" style="align-items:flex-start;">
        <div>
          <div class="page-title" style="font-size:22px;">Admin Panel</div>
          <div class="subtitle" style="margin-bottom:12px;">Manage users and role permissions.</div>
        </div>
        <button class="btn ghost" id="close-admin">Close</button>
      </div>

        <div class="flex-between" style="margin-top:12px; gap:8px;">
        <div class="flex-between" style="gap:6px;">
          <button class="btn ghost" id="admin-tab-users" style="padding:6px 12px;">Users</button>
          <button class="btn ghost" id="admin-tab-roles" style="padding:6px 12px;">Roles</button>
          <button class="btn ghost" id="admin-tab-tracking" style="padding:6px 12px;">Tracking</button>
          <button class="btn ghost" id="admin-tab-vendors" style="padding:6px 12px;">Vendors</button>
          <button class="btn ghost" id="admin-tab-google" style="padding:6px 12px;">Google</button>
        </div>
      </div>

      <div id="admin-users-section" style="display:none;">
        <div class="card" style="background:var(--panel-2); margin-top:12px;">
          <div class="flex-between" style="align-items:center; gap:8px;">
            <div class="page-title" style="font-size:18px;">Users</div>
            <button class="btn primary" id="new-user-btn" style="padding:6px 10px;">New user</button>
          </div>
          <div id="user-list" class="small" style="margin-top:8px;">Loading users...</div>
        </div>
      </div>

      <div id="admin-roles-section" style="display:none;">
        <div class="card" style="background:var(--panel-2); margin-top:12px;">
          <div class="page-title" style="font-size:18px;">Role Permissions</div>
          <div class="subtitle">Toggle what each role can do.</div>
          <div id="role-list" style="margin-top:8px;"></div>
          <div id="role-message" class="small" style="margin-top:6px;"></div>
        </div>
      </div>

      <div id="admin-tracking-section" style="display:none;">
        <div class="card" style="background:var(--panel-2); margin-top:12px;">
        <div class="page-title" style="font-size:18px;">Tracking Settings</div>
        <div class="subtitle">Carrier API keys, refresh cadence, and manual refresh.</div>
        <form id="tracking-settings-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:8px; margin-top:10px;">
          <div>
            <label class="small">UPS Client ID</label>
            <input name="upsClientId" class="input" placeholder="UPS OAuth client id" />
          </div>
          <div>
            <label class="small">UPS Client Secret</label>
            <input name="upsClientSecret" class="input" placeholder="UPS OAuth client secret" />
          </div>
          <div>
            <label class="small">USPS User ID</label>
            <input name="uspsUserId" class="input" placeholder="USPS WebTools user id" />
          </div>
          <div>
            <label class="small">FedEx Client ID</label>
            <input name="fedexClientId" class="input" placeholder="FedEx API key" />
          </div>
          <div>
            <label class="small">FedEx Client Secret</label>
            <input name="fedexClientSecret" class="input" placeholder="FedEx API secret" />
          </div>
          <div>
            <label class="small">Tracking Refresh Interval (minutes)</label>
            <input name="refreshMinutes" class="input" type="number" min="1" value="30" />
          </div>
        </form>
        <div class="flex-between" style="grid-column: span 2; margin-top:8px; flex-wrap:wrap; gap:8px;">
          <div id="tracking-settings-message" class="small"></div>
          <div class="flex-between" style="gap:8px; flex-wrap:wrap;">
            <button type="button" class="btn ghost" id="refresh-tracking-now">Manual refresh</button>
            <button type="submit" form="tracking-settings-form" class="btn primary">Save settings</button>
          </div>
        </div>
      </div>
      </div>

      <div id="admin-vendors-section" style="display:none;">
        <div class="card" style="background:var(--panel-2); margin-top:12px;">
          <div class="flex-between" style="align-items:center; gap:8px;">
            <div>
              <div class="page-title" style="font-size:18px;">Vendor Extraction Settings</div>
              <div class="subtitle">Configure how to pull product details from each vendor.</div>
            </div>
            <button class="btn primary" id="new-vendor-btn" style="padding:6px 10px;">New vendor</button>
          </div>
          <div id="vendor-list" class="small" style="margin-top:10px;">Loading vendors...</div>
        </div>
      </div>

      <div id="admin-google-section" style="display:none;">
        <div class="card" style="background:var(--panel-2); margin-top:12px;">
          <div class="page-title" style="font-size:18px;">Google Drive Credentials</div>
          <div class="subtitle">Upload service account JSON and set the Drive folder ID for receipts.</div>
          <form id="google-credentials-form" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap:8px; margin-top:10px;">
            <div>
              <label class="small">Drive Folder ID</label>
              <input name="folderId" id="google-folder-id" class="input" placeholder="Folder ID from https://drive.google.com/drive/folders/..." />
            </div>
            <div style="grid-column: span 2;">
              <label class="small">Service Account JSON</label>
              <input type="file" id="google-credentials-file" class="input" accept=".json,application/json" />
              <div class="small">Upload the JSON file you downloaded for the service account. We store the private key securely in Convex.</div>
            </div>
            <div class="flex-between" style="grid-column: span 2; align-items:center; gap:8px; flex-wrap:wrap;">
              <div id="google-credentials-message" class="small"></div>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button type="button" class="btn ghost" id="refresh-google-credentials">Refresh</button>
                <button type="submit" class="btn primary">Save Google credentials</button>
              </div>
            </div>
          </form>
          <div id="google-credentials-summary" class="small" style="margin-top:10px;"></div>
        </div>
      </div>

    </div>
  </div>

  </div> <!-- end app-shell -->

    <script src="/js/dom.js"></script>
    <script src="/js/views.js"></script>
    <script src="/js/vendor.js"></script>
    <script src="/js/modals.js"></script>
    <script src="/js/app.js"></script>

</body>
</html>
